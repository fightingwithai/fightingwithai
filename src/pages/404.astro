---
import Layout from "../layouts/Layout.astro";
import NotFound from "bearing-dev/packages/lighthouse/NotFound.astro";
import { getAllCollectionsSorted } from "../utils/collections";

// Build a list of all valid URLs at build time for fuzzy matching
const collections = await getAllCollectionsSorted();
const allPages = collections.flatMap((collection) =>
  collection.entries.map((entry) => ({
    url: `/${collection.name}/${entry.slug}/`,
    title: entry.data.title,
    section: collection.displayName,
  }))
);

// Add collection index pages
const collectionIndexes = collections.map((collection) => ({
  url: `/${collection.name}/`,
  title: collection.displayName,
  section: "Section Index",
}));

const pages = [...allPages, ...collectionIndexes, { url: "/", title: "Home", section: "" }];
---

<Layout title="Page Not Found - Fighting With AI">
  <style>
    /* Override lighthouse default styles with site theme */
    .lighthouse-container {
      --lighthouse-accent: var(--color-accent);
      --lighthouse-text: var(--color-text);
      --lighthouse-text-muted: var(--color-text-muted);
      --lighthouse-surface: var(--color-surface);
      --lighthouse-border: var(--color-border);
      --lighthouse-accent-dim: var(--color-accent-dim);
    }

    .lighthouse-code {
      font-size: var(--text-4xl);
    }

    .lighthouse-title {
      font-size: var(--text-2xl);
    }

    .lighthouse-suggestion-link {
      border-radius: var(--radius-lg);
    }

    .lighthouse-redirect {
      border-radius: var(--radius-lg);
    }
  </style>

  <NotFound
    pages={pages}
    autoRedirectThreshold={0.6}
    maxSuggestions={5}
  >
    <Fragment slot="actions">
      <a href="/" class="btn btn-primary">Go Home</a>
      <a href="/concepts/" class="btn btn-secondary">Browse Concepts</a>
    </Fragment>
  </NotFound>
</Layout>
